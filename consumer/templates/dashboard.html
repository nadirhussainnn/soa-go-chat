<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Go Chat - Dashboard</title>
    <link rel="stylesheet" href="/static/index.css">
    <link rel="stylesheet" href="/static/dashboard.css">
</head>
<body>
    <!-- Include Header -->
    {{ template "dashboard_header.html" }}

    <!-- Main Content -->
    <div class="contact-chat-container">
        <!-- Contact List -->
        <div class="contact-list">
            <div class="filter-component">
                <button id="filter-contacts" class="filter-btn active">Contacts</button>
                <button id="filter-requests" class="filter-btn">Requests</button>
            </div>
            <div class="search-component">
                <input type="text" id="search" placeholder="Search contacts...">
            </div>
            <ul id="contact-list" class="list-items">
                <!-- Contacts List -->
                {{ range .Contacts }}
                <li class="list-item contact-item">
                    <p class="username">{{ .Name }}</p>
                </li>
                {{ end }}

                <!-- Requests List -->
            {{ range .ContactRequests }}
            <li class="list-item request-item hidden">
                <p><strong>From:</strong> {{ .SenderDetails.Username }} ({{ .SenderDetails.Email }})</p>
                <p><strong>To:</strong> {{ .ReceiverID }}</p>
                <p><strong>Status:</strong> {{ .Status }}</p>
                <p><strong>Date:</strong> {{ .CreatedAtFormatted }}</p>
            </li>
            {{ end }}
            </ul>
        </div>

        <!-- Chat Container -->
        <div class="chat-container">
            {{ template "chat.html" }}
        </div>
    </div>

    <script>
        // DOM references
        const contactListElement = document.getElementById('contact-list');
        const searchInput = document.getElementById('search');
        const filterContactsBtn = document.getElementById('filter-contacts');
        const filterRequestsBtn = document.getElementById('filter-requests');
        const chatHeaderElement = document.querySelector('.chat-header .username');
        const chatMessagesElement = document.querySelector('.chat-messages');

        let activeFilter = 'contacts'; // Default to showing contacts

        // Toggle between Contacts and Requests
        filterContactsBtn.addEventListener('click', () => {
            activeFilter = 'contacts';
            filterContactsBtn.classList.add('active');
            filterRequestsBtn.classList.remove('active');
            searchInput.placeholder = 'Search contacts...';
            updateFilter();
        });

        filterRequestsBtn.addEventListener('click', () => {
            activeFilter = 'requests';
            filterRequestsBtn.classList.add('active');
            filterContactsBtn.classList.remove('active');
            searchInput.placeholder = 'Search requests...';
            updateFilter();
        });

        // Update the displayed list based on the active filter
        function updateFilter() {
            const contactItems = document.querySelectorAll('.list-item.contact-item');
            const requestItems = document.querySelectorAll('.list-item.request-item');

            if (activeFilter === 'contacts') {
                contactItems.forEach(item => item.classList.remove('hidden'));
                requestItems.forEach(item => item.classList.add('hidden'));
            } else {
                contactItems.forEach(item => item.classList.add('hidden'));
                requestItems.forEach(item => item.classList.remove('hidden'));
            }
        }

        // Search functionality
        searchInput.addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase();
            const listItems = document.querySelectorAll(
                activeFilter === 'contacts'
                    ? '.list-item.contact-item'
                    : '.list-item.request-item'
            );
            listItems.forEach(item => {
                const textContent = item.textContent.toLowerCase();
                if (textContent.includes(query)) {
                    item.classList.remove('hidden');
                } else {
                    item.classList.add('hidden');
                }
            });
        });

        // Load chat for the selected contact
        contactListElement.addEventListener('click', (e) => {
            const listItem = e.target.closest('.list-item.contact-item');
            if (listItem) {
                const contactName = listItem.querySelector('.username').textContent;
                chatHeaderElement.textContent = contactName; // Update chat header
                chatMessagesElement.innerHTML = ''; // Clear previous messages
                chatMessagesElement.innerHTML = `<div class="message-bubble received"><p>Welcome to the chat with ${contactName}!</p></div>`;
            }
        });

        // Initialize with contacts visible
        updateFilter();
    </script>
</body>
</html>
